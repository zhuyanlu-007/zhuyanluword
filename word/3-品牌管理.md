**三，品牌管理**

**1.品牌查询**

**前台**

官网地址: 

表格:https://v15.vuetifyjs.com/zh-Hans/components/data-tables 

输入框:https://v15.vuetifyjs.com/zh-Hans/components/snackbars 

按钮:https://v15.vuetifyjs.com/zh-Hans/components/buttons

在item包下新建MrBrand.vue

```
<template>
  <v-card>
    <v-card-title>
      <v-btn color="info" @click="dialog = true">新增</v-btn>
      <div class="text-xs-center">
        <v-dialog v-model="dialog" width="500">
          <v-card>
            <v-card-title class="headline grey lighten-2" primary-title>
            品牌 {{isEdit?'修改':'新增'}}
           </v-card-title>
            <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail"/>
          </v-card>
        </v-dialog>
      </div>
      <!-- 调按钮和输入框之间的间距 -->
      <v-spacer />
      <!--append-icon : 图标 label : input默认值-->
      <v-text-field
        append-icon="search"
        label="品牌名称"
        @keyup.enter="getTableData()"
        v-model="search"
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="desserts"
      :pagination.sync="pagination"
      :total-items="total"
      class="elevation-1"
    >
      <!-- 注意此处不能只能用官网的属性,应当参照Brand.vue的写法 -->
      <template slot="items" slot-scope="props">
        <td class="text-xs-center">{{ props.item.id }}</td>
        <td class="text-xs-center">{{ props.item.name }}</td>
        <!-- :src 给元素绑定src属性 属性的值为props.item.image -->
        <td class="text-xs-center">
          <img width="200" :src="props.item.image" />
          </td>
        <td class="text-xs-center">{{ props.item.letter }}</td>
        <td class="text-xs-center">
            <v-btn falt icon  @click="editDialog(props.item)" color="green">
                <v-icon>edit</v-icon>
            </v-btn>
            <v-btn falt icon @click="delDialog(props.item.id)" color="red">
                <v-icon>delete</v-icon>
            </v-btn>
        </td>
      </template>
    </v-data-table>
  </v-card>
</template>
<script>
import MrBrandForm from './MrBrandForm';
export default {
  name: "MrBrand",
  components:{
    MrBrandForm
  },
  data() {
    return {
      brandDetail:{},
      isEdit:false,
      dialog:false,
      pagination: {},
      total: 0,
      search: "",
      headers: [
        {
          text: "id",
          align: "center",
          value: "id",
        },
        {
          text: "品牌名称",
          align: "center",
          value: "name",
        },
        {
          text: "品牌logo",
          align: "center",
          value: "image",
        },
        {
          text: "首字母",
          align: "center",
          value: "letter",
        },
        {
          text: "操作",
          align: "center",
          sortable: false,
          value: "id",
        }
      ],
      desserts: [],
    };
  },
  mounted() {
    this.getTableData();
  },
  methods: {
    closeDialog(){
      this.dialog = false;
      this.getTableData()
    },
    addDialog(){
      this.isEdit = false;
      this.dialog = true;
    },
    editDialog(obj){
      this.brandDetail = obj;
      this.isEdit = true;
      this.dialog = true;
    },
    delDialog(id){
      this.$http.delete('brand/del?id=' + id).then(resp =>{
        if(resp.data.code == 200){
            this.getTableData()
            this.$message.success('删除成功')
        }else{
          this.$message.error(resp.data.msg)
        }
      }).catch(error => console.log(error))
    },
    getTableData() {
      this.$http
        .get("/brand/list", {
          params: {
            page: this.pagination.page,
            rows: this.pagination.rowsPerPage,
            sort: this.pagination.sortBy,
            order: this.pagination.descending,
            name: this.search,
          },
        })
        .then((resp) => {
          this.desserts = resp.data.data.list;
          this.total = resp.data.data.total;
        })
        .catch((error) => console.log(error));
    },
  },
  watch: {
    pagination() {
      this.getTableData();
    },
  },
};
</script>
```

index.js line : 27

```
route("/item/brand",'/item/MrBrand',"MrBrand"),
```

**后台**

mingrui-shop-common-core

pom.xml

```
<!--帮助开发人员快速生成API文档-->
<dependency>
    <groupId>io.springfox</groupId>
    <artifactId>springfox-swagger2</artifactId>
    <version>2.9.2</version>
</dependency>

```

com.baidu.shop.validate.group

 MingruiOperation

```
public interface Search{}
```

在com.baidu.shop.base包下新建BaseDTO

```
package com.baidu.shop.base;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
@ApiModel(value = "BaseDTO用于数据传输,其他dto需要继承此类")
public class BaseDTO {

    @ApiModelProperty(value = "当前页",example = "1")
    private Integer page;

    @ApiModelProperty(value = "每页显示多少条",example = "5")
    private Integer rows;

    @ApiModelProperty(value = "排序字段")
    private String sort;

    @ApiModelProperty(value = "是否升序")
    private String order;

    public String getOrder() {
        return sort + " " + (Boolean.valueOf(order) ? "desc":"asc");
    }
}
```

mingrui-shop-service-api

pom.xml

```
<!--分页工具-->
<dependency>
    <groupId>com.github.pagehelper</groupId>
    <artifactId>pagehelper-spring-boot-starter</artifactId>
    <version>1.2.10</version>
</dependency>
```

mingrui-shop-service-api-xxx

在com.baidu.shop下新建dto包

新建BrandDto

```
package com.baidu.shop.dto;

import com.baidu.shop.base.BaseDTO;
import com.baidu.shop.validate.group.MingruiOperation;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

import javax.validation.constraints.NotEmpty;
import javax.validation.constraints.NotNull;

@Data
@ApiModel(value = "品牌DTO")
public class BrandDto extends BaseDTO {

    @ApiModelProperty(value = "品牌ID",example = "1")
    @NotNull(message = "主键不能为空",groups = {MingruiOperation.Add.class,MingruiOperation.Update.class})
    private Integer id;

    @ApiModelProperty(value = "品牌名称",example = "1")
    @NotEmpty(message = "品牌名称不能为空",groups = {MingruiOperation.Add.class, MingruiOperation.Update.class})
    private String name;

    @ApiModelProperty(value = "品牌图片")
    private String image;

    @ApiModelProperty(value = "品牌首字母")
    private Character letter;
}
```

com.baidu.shop.service包下新建BrandService

```
package com.baidu.shop.service;

import com.baidu.shop.base.Result;
import com.baidu.shop.dto.BrandDTO;
import com.baidu.shop.entity.BrandEntity;
import com.github.pagehelper.PageInfo;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.web.bind.annotation.GetMapping;

import java.util.List;

@Api(tags = "品牌接口")
public interface BrandService {
    @GetMapping(value = "brand/list")
    @ApiOperation(value = "查询品牌列表")
    Result<List<BrandEntity>> getBrandInfo(BrandDto brandDto);
}
```

mingrui-shop-service-xxx

在mapper包下新建BrandMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.BrandEntity;
import tk.mybatis.mapper.common.Mapper;

public interface BrandMapper extends Mapper<BrandEntity> {
}
```

com.baidu.shop.service.impl

新建BrandServiceImpl

```
import com.baidu.shop.base.BaseApiService;
import com.baidu.shop.base.Result;
import com.baidu.shop.dto.BrandDTO;
import com.baidu.shop.entity.BrandEntity;
import com.baidu.shop.mapper.BrandMapper;
import com.baidu.shop.service.BrandService;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import org.springframework.util.StringUtils;
import org.springframework.web.bind.annotation.RestController;
import tk.mybatis.mapper.entity.Example;
import javax.annotation.Resource;
import java.util.List;

@RestController
public class BrandServiceImpl extends BaseApiService implements BrandService{

    @Autowired
    private BrandMapper brandMapper;

    //查询品牌
    @Override
    public Result<List<BrandEntity>> getBrandInfo(BrandDto brandDto) {
        //mybatis如何自定义分页插件 --》 mybatis执行器
        PageHelper.startPage(brandDto.getPage(),brandDto.getRows());
        if (!StringUtils.isEmpty(brandDto.getSort()))PageHelper.orderBy(brandDto.getOrder());

        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDto, BrandEntity.class);

        Example example = new Example(BrandEntity.class);
        example.createCriteria().andLike("name","%" + brandEntity.getName() + "%");

        List<BrandEntity> brandEntities = brandMapper.selectByExample(example);
        PageInfo<BrandEntity> pageInfo = new PageInfo<>(brandEntities);
        return this.setResultSuccess(pageInfo);
    }
```

**2.品牌新增**

**前台**vue项目 

 新建MrBrandForm.vue

```
<template>
  <v-card>
    <v-card-title>
      <v-btn color="info" @click="dialog = true">新增</v-btn>
      <div class="text-xs-center">
        <v-dialog v-model="dialog" width="500">
          <v-card>
            <v-card-title class="headline grey lighten-2" primary-title>
            品牌 {{isEdit?'修改':'新增'}}
           </v-card-title>
            <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail"/>
          </v-card>
        </v-dialog>
      </div>
      <!-- 调按钮和输入框之间的间距 -->
      <v-spacer />
      <!--append-icon : 图标 label : input默认值-->
      <v-text-field
        append-icon="search"
        label="品牌名称"
        @keyup.enter="getTableData()"
        v-model="search"
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="desserts"
      :pagination.sync="pagination"
      :total-items="total"
      class="elevation-1"
    >
      <!-- 注意此处不能只能用官网的属性,应当参照Brand.vue的写法 -->
      <template slot="items" slot-scope="props">
        <td class="text-xs-center">{{ props.item.id }}</td>
        <td class="text-xs-center">{{ props.item.name }}</td>
        <!-- :src 给元素绑定src属性 属性的值为props.item.image -->
        <td class="text-xs-center">
          <img width="200" :src="props.item.image" />
          </td>
        <td class="text-xs-center">{{ props.item.letter }}</td>
        <td class="text-xs-center">
            <v-btn falt icon  @click="editDialog(props.item)" color="green">
                <v-icon>edit</v-icon>
            </v-btn>
            <v-btn falt icon @click="delDialog(props.item.id)" color="red">
                <v-icon>delete</v-icon>
            </v-btn>
        </td>
      </template>
    </v-data-table>
  </v-card>
</template>
<script>
import MrBrandForm from './MrBrandForm';
export default {
  name: "MrBrand",
  components:{
    MrBrandForm
  },
  data() {
    return {
      brandDetail:{},
      isEdit:false,
      dialog:false,
      pagination: {},
      total: 0,
      search: "",
      headers: [
        {
          text: "id",
          align: "center",
          value: "id",
        },
        {
          text: "品牌名称",
          align: "center",
          value: "name",
        },
        {
          text: "品牌logo",
          align: "center",
          value: "image",
        },
        {
          text: "首字母",
          align: "center",
          value: "letter",
        },
        {
          text: "操作",
          align: "center",
          sortable: false,
          value: "id",
        }
      ],
      desserts: [],
    };
  },
  mounted() {
    this.getTableData();
  },
  methods: {
    closeDialog(){
      this.dialog = false;
      this.getTableData()
    },
    addDialog(){
      this.isEdit = false;
      this.dialog = true;
    },
    editDialog(obj){
      this.brandDetail = obj;
      this.isEdit = true;
      this.dialog = true;
    },
    delDialog(id){
      this.$http.delete('brand/del?id=' + id).then(resp =>{
        if(resp.data.code == 200){
            this.getTableData()
            this.$message.success('删除成功')
        }else{
          this.$message.error(resp.data.msg)
        }
      }).catch(error => console.log(error))
    },
    getTableData() {
      this.$http
        .get("/brand/list", {
          params: {
            page: this.pagination.page,
            rows: this.pagination.rowsPerPage,
            sort: this.pagination.sortBy,
            order: this.pagination.descending,
            name: this.search,
          },
        })
        .then((resp) => {
          this.desserts = resp.data.data.list;
          this.total = resp.data.data.total;
        })
        .catch((error) => console.log(error));
    },
  },
  watch: {
    pagination() {
      this.getTableData();
    },
  },
};
</script>
```

Casecader.vue需要修改113行

MrBrand.vue

```
<template>
  <v-card>
    <v-card-title>
      <v-btn color="info" @click="dialog = true">新增</v-btn>
      <div class="text-xs-center">
        <v-dialog v-model="dialog" width="500">
          <v-card>
            <v-card-title class="headline grey lighten-2" primary-title>
            品牌 {{isEdit?'修改':'新增'}}
           </v-card-title>
            <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail"/>
          </v-card>
        </v-dialog>
      </div>
      <!-- 调按钮和输入框之间的间距 -->
      <v-spacer />
      <!--append-icon : 图标 label : input默认值-->
      <v-text-field
        append-icon="search"
        label="品牌名称"
        @keyup.enter="getTableData()"
        v-model="search"
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="desserts"
      :pagination.sync="pagination"
      :total-items="total"
      class="elevation-1"
    >
      <!-- 注意此处不能只能用官网的属性,应当参照Brand.vue的写法 -->
      <template slot="items" slot-scope="props">
        <td class="text-xs-center">{{ props.item.id }}</td>
        <td class="text-xs-center">{{ props.item.name }}</td>
        <!-- :src 给元素绑定src属性 属性的值为props.item.image -->
        <td class="text-xs-center">
          <img width="200" :src="props.item.image" />
          </td>
        <td class="text-xs-center">{{ props.item.letter }}</td>
        <td class="text-xs-center">
            <v-btn falt icon  @click="editDialog(props.item)" color="green">
                <v-icon>edit</v-icon>
            </v-btn>
            <v-btn falt icon @click="delDialog(props.item.id)" color="red">
                <v-icon>delete</v-icon>
            </v-btn>
        </td>
      </template>
    </v-data-table>
  </v-card>
</template>
<script>
import MrBrandForm from './MrBrandForm';
export default {
  name: "MrBrand",
  components:{
    MrBrandForm
  },
  data() {
    return {
      brandDetail:{},
      isEdit:false,
      dialog:false,
      pagination: {},
      total: 0,
      search: "",
      headers: [
        {
          text: "id",
          align: "center",
          value: "id",
        },
        {
          text: "品牌名称",
          align: "center",
          value: "name",
        },
        {
          text: "品牌logo",
          align: "center",
          value: "image",
        },
        {
          text: "首字母",
          align: "center",
          value: "letter",
        },
        {
          text: "操作",
          align: "center",
          sortable: false,
          value: "id",
        }
      ],
      desserts: [],
    };
  },
  mounted() {
    this.getTableData();
  },
  methods: {
    closeDialog(){
      this.dialog = false;
      this.getTableData()
    },
    addDialog(){
      this.isEdit = false;
      this.dialog = true;
    },
    editDialog(obj){
      this.brandDetail = obj;
      this.isEdit = true;
      this.dialog = true;
    },
    delDialog(id){
      this.$http.delete('brand/del?id=' + id).then(resp =>{
        if(resp.data.code == 200){
            this.getTableData()
            this.$message.success('删除成功')
        }else{
          this.$message.error(resp.data.msg)
        }
      }).catch(error => console.log(error))
    },
    getTableData() {
      this.$http
        .get("/brand/list", {
          params: {
            page: this.pagination.page,
            rows: this.pagination.rowsPerPage,
            sort: this.pagination.sortBy,
            order: this.pagination.descending,
            name: this.search,
          },
        })
        .then((resp) => {
          this.desserts = resp.data.data.list;
          this.total = resp.data.data.total;
        })
        .catch((error) => console.log(error));
    },
  },
  watch: {
    pagination() {
      this.getTableData();
    },
  },
};
</script>
```

### 后台

mingrui-shop-common-core

在utils包下新建BaiduBeanUtil

```
package com.baidu.shop.utils;

import org.springframework.beans.BeanUtils;

public class BaiduBeanUtil<T>{
    public static <T> T copyProperties(Object source,Class<T> tClass) {
        T t=null;
        try {
            t = tClass.newInstance();//创建实例
            BeanUtils.copyProperties(source, t);
        } catch (InstantiationException e) {
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            e.printStackTrace();
        }
        return t;
    }
}
```

mingrui-shop-service-api-xxx

com.baidu.shop.dto BrandDto

```
@ApiModelProperty(value = "品牌分类信息")
@NotEmpty(message = "品牌分类信息不能为空",groups = {MingruiOperation.Add.class})
private String categories;
```

com.baidu.shop.entity包下新建CategoryBrandEntity

```
package com.baidu.shop.entity;

import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;

import javax.persistence.Table;

@Data
@Table(name = "tb_category_brand")
@NoArgsConstructor
@AllArgsConstructor
public class CategoryBrandEntity {
    private Integer categoryId;

    private Integer brandId;
}
```

com.baidu.shop.service：BrandService

```
@PostMapping(value = "brand/save")
@ApiOperation(value = "新增品牌")
Result<JsonObject> save(@RequestBody BrandDto brandDto);
```

mingrui-shop-service-xxx

在mapper包下新建CategoryBrandMapper

```
package com.baidu.shop.mapper;

import com.baidu.shop.entity.CategoryBrandEntity;
import tk.mybatis.mapper.common.Mapper;
import tk.mybatis.mapper.common.special.InsertListMapper;

public interface CategoryBrandMapper extends InsertListMapper<CategoryBrandEntity>, Mapper<CategoryBrandEntity> {
}
```

com.baidu.shop.service.impl：BrandServiceImpl

```
//新增品牌
    @Transactional
    @Override
    public Result<JsonObject> save(BrandDto brandDto) {

        //新增返回主键?
        //两种方式实现 select-key insert加两个属性
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDto,BrandEntity.class);
        //处理品牌首字母
        brandDto.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandDto.getName().charAt(0)),PinyinUtil.TO_FUUL_PINYIN).charAt(0));

        brandMapper.insertSelective(brandEntity);
        //维护中间表数据
        this.insetrCategoryBrandList(brandDto.getCategories(),brandEntity.getId());
        return this.setResultSuccess();
    }
```

```
//新增修改整合
private void insetrCategoryBrandList (String categories,Integer brandId){
    if (StringUtils.isEmpty(categories))throw new RuntimeException("分类信息不能为空");

    //判断分类集合字符串中是否包含,
    if(categories.contains(",")){
        categoryBrandMapper.insertList(
            //数组转list
            Arrays.asList(categories.split(","))
                    //获取stream流，流：对一次数据进行操作
                    .stream()
                    //遍历list中所有数据
                    .map(categoryById->new CategoryBrandEntity(Integer.valueOf(categoryById),brandId))
                    //最终转换成list
                    .collect(Collectors.toList())
        );
    }else{
        CategoryBrandEntity categoryBrandEntity = new CategoryBrandEntity();
        categoryBrandEntity.setCategoryId(Integer.valueOf(categories));
        categoryBrandEntity.setBrandId(brandId);

        categoryBrandMapper.insertSelective(categoryBrandEntity);
    }
}
```

**新增遗留的问题** 

**品牌首字母自动识别** 

**vue项目**

#### 前台

将MrBrandForm.vue组件中所有关于首字母的内容删除掉

```
<template>
    <div>
            <v-form v-model="valid" ref="form">
                <v-text-field v-model="brand.name" label="品牌名称" :rules="nameRules" required></v-text-field>
                <v-cascader url="/category/list" required v-model="brand.categories" multiple label="商品分类"/>
                <!-- 文件上传 -->
                <v-layout row>
                    <v-flex xs3>
                      <span style="font-size: 16px; color: #444">品牌LOGO:</span>
                    </v-flex>
                    <v-flex>
                        <v-upload
                          v-model="brand.image"
                          url="/upload"
                          :multiple="false"
                          :pic-width="250"
                          :pic-height="100"
                        />
                    </v-flex>
                </v-layout> 
            </v-form>
         <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn small @click="cancel()">取消</v-btn>
          <v-btn small color="red"  @click="submitForm">确认</v-btn>
        </v-card-actions>
    </div>
</template>
<script>
  export default {
    name:"MrBrandForm",
    props:{
      //父组件传递过来的模态框状态
      dialog: Boolean,
      brandDetail: Object,
      isEdit: Boolean
    },
    watch:{
      dialog(val){
        if(val) this.$refs.form.reset();
      },
      brandDetail(val){
        if(this.isEdit){
            this.$http.get('category/getByBrand',{
              params:{
                brandId:val.id
              }
            }).then(resp =>{
              console.log(resp);
              let brand = val;
              brand.categories = resp.data.data;
              this.brand = brand;
            }).catch(error => console.log(error))
            // this.brand=val;
        }
      }
    },
    data () {
      //在js中 null == false , '' == false , undefined == false , 0 == false
      return {
        valid: true,
        nameRules:[
          (v) => !!v || '品牌名称不能为空',
          (v) => (v && v.length <= 10) || '品牌名称长度最长10'
        ],
        brand:{
            name:"",
            letter:"",
            categories:[],
          
        }
      }
    },
    methods:{
        cancel(){
            this.$emit("closeDialog");
        },
        submitForm(){
            if(!this.$refs.form.validate()){
                return;
            }
            let fromData = this.brand;
            let categoryIdArr = this.brand.categories.map(category =>category.id);
            fromData.categories = categoryIdArr.join();

            //$.ajax() 和 $.get() | $.post()方法的区别?
            this.$http({
              url:'/brand/save',
              data:fromData,
              method:this.isEdit ? 'put':'post'
              }).then(resp=>{
                if(resp.data.code != 200){
                    return;
                }
                   //关闭模态框
                    this.cancel();
            }).catch(error => console.log(error))
        }
    }   
  }
</script>
```

#### 后台

mingrui-shop-common-core

pom.xml

```
<dependency>
    <groupId>com.belerweb</groupId>
    <artifactId>pinyin4j</artifactId>
    <version>2.5.1</version>
</dependency>
```

com.baidu.shop.utils包下新建PinyinUtil

```
package com.baidu.shop.utils;

import net.sourceforge.pinyin4j.PinyinHelper;
import net.sourceforge.pinyin4j.format.HanyuPinyinOutputFormat;
import net.sourceforge.pinyin4j.format.HanyuPinyinToneType;
import java.util.regex.Matcher;
import java.util.regex.Pattern;


public class PinyinUtil {
    public static final Boolean TO_FUUL_PINYIN = true;
    public static final Boolean TO_FIRST_CHAR_PINYIN = false;
    /**
     * 获取汉字首字母或全拼大写字母
     *
     * @param chinese 汉字
     * @param isFull 是否全拼 true:表示全拼 false表示：首字母
     * @return 全拼或者首字母大写字符窜
     */
    public static String getUpperCase(String chinese, boolean isFull) {
        return convertHanzi2Pinyin(chinese, isFull).toUpperCase();
    }
    /**
     * 获取汉字首字母或全拼小写字母
     *
     * @param chinese 汉字
     * @param isFull 是否全拼 true:表示全拼 false表示：首字母
     * @return 全拼或者首字母小写字符窜
     */
    public static String getLowerCase(String chinese, boolean isFull) {
        return convertHanzi2Pinyin(chinese, isFull).toLowerCase();
    }
    /**
     * 将汉字转成拼音
     * <p>
     * 取首字母或全拼
     *
     * @param hanzi 汉字字符串
     * @param isFull 是否全拼 true:表示全拼 false表示：首字母
     * @return 拼音
     */
    private static String convertHanzi2Pinyin(String hanzi, boolean isFull) {
/***
 * ^[\u2E80-\u9FFF]+$ 匹配所有东亚区的语言
 * ^[\u4E00-\u9FFF]+$ 匹配简体和繁体
 * ^[\u4E00-\u9FA5]+$ 匹配简体
 */
        String regExp = "^[\u4E00-\u9FFF]+$";
        StringBuffer sb = new StringBuffer();
        if (hanzi == null || "".equals(hanzi.trim())) {
            return "";
        }
        String pinyin = "";
        for (int i = 0; i < hanzi.length(); i++) {
            char unit = hanzi.charAt(i);
//是汉字，则转拼音
            if (match(String.valueOf(unit), regExp)) {
                pinyin = convertSingleHanzi2Pinyin(unit);
                if (isFull) {
                    sb.append(pinyin);
                } else {
                    sb.append(pinyin.charAt(0));
                }
            } else {
                sb.append(unit);
            }
        }
        return sb.toString();
    }
    /**
     * 将单个汉字转成拼音
     *
     * @param hanzi 汉字字符
     * @return 拼音
     */
    private static String convertSingleHanzi2Pinyin(char hanzi) {
        HanyuPinyinOutputFormat outputFormat = new HanyuPinyinOutputFormat();
        outputFormat.setToneType(HanyuPinyinToneType.WITHOUT_TONE);
        String[] res;
        StringBuffer sb = new StringBuffer();
        try {
            res = PinyinHelper.toHanyuPinyinStringArray(hanzi, outputFormat);
            sb.append(res[0]);//对于多音字，只用第一个拼音
        } catch (Exception e) {
            e.printStackTrace();
            return "";
        }
        return sb.toString();
    }
    /***
     * 匹配
     * <P>
     * 根据字符和正则表达式进行匹配
     *
     * @param str 源字符串
    4.1.3 mingrui-shop-service-xxx
    4.1.3.1 BrandServiceImpl
     * @param regex 正则表达式
     *
     * @return true：匹配成功 false：匹配失败
     */
    private static boolean match(String str, String regex) {
        Pattern pattern = Pattern.compile(regex);
        Matcher matcher = pattern.matcher(str);
        return matcher.find();
    }

}
```

mingrui-shop-service-xxx

com.baidu.shop.service.impl

```
@Override
public Result<JSONObject> save(BrandDTO brandDTO) {
    //str.charAt(0)获取当前字符串第一个字符
    //String.valueOf()将对象转换为String类型的字符串
    //
    // char c = brandDTO.getName().charAt(0);
    // String s = String.valueOf(c);
    // String upperCase = PinyinUtil.getUpperCase(s,
    PinyinUtil.TO_FIRST_CHAR_PINYIN);
    // char c1 = upperCase.charAt(0);
    // brandDTO.setLetter(c1);
    brandDTO.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandDTO.getName().ch
    arAt(0)),PinyinUtil.TO_FIRST_CHAR_PINYIN).charAt(0));
    try {
        BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDTO,
        BrandEntity.class);
        //通用mapper新增返回主键
        brandMapper.insertSelective(brandEntity);
            //绑定关系
            if(StringUtils.isEmpty(brandDTO.getCategories())){
            	return this.setResultError("分类数据不能为空");
            }
            if(brandDTO.getCategories().contains(",")){
                List<CategoryBrandEntity> list = new ArrayList<>();
                String[] categoryArr = brandDTO.getCategories().split(",");
                Arrays.asList(categoryArr).stream().forEach(str -> {
                    CategoryBrandEntity categoryBrandEntity = new
                    CategoryBrandEntity();
                    categoryBrandEntity.setBrandId(brandEntity.getId());
                    categoryBrandEntity.setCategoryId(Integer.parseInt(str));
                    list.add(categoryBrandEntity);
            	});
   	 		categoryBrandMapper.insertList(list);
    		}
    } catch (Exception e) {
   	 	e.printStackTrace();
    }
    return this.setResultSuccess();
}
```

**清空form和表单验证的问题** 

MrBrand.vue

```
<mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail"/>
```

MrBrandFrom.vue

```
<template>
    <div>
            <v-form v-model="valid" ref="form">
                <v-text-field v-model="brand.name" label="品牌名称" :rules="nameRules" required></v-text-field>
                <v-cascader url="/category/list" required v-model="brand.categories" multiple label="商品分类"/>
                <!-- 文件上传 -->
                <v-layout row>
                    <v-flex xs3>
                      <span style="font-size: 16px; color: #444">品牌LOGO:</span>
                    </v-flex>
                    <v-flex>
                        <v-upload
                          v-model="brand.image"
                          url="/upload"
                          :multiple="false"
                          :pic-width="250"
                          :pic-height="100"
                        />
                    </v-flex>
                </v-layout> 
            </v-form>
         <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn small @click="cancel()">取消</v-btn>
          <v-btn small color="red"  @click="submitForm">确认</v-btn>
        </v-card-actions>
    </div>
</template>
<script>
  export default {
    name:"MrBrandForm",
    props:{
      //父组件传递过来的模态框状态
      dialog: Boolean,
      brandDetail: Object,
      isEdit: Boolean
    },
    watch:{
      dialog(val){
        if(val) this.$refs.form.reset();
      },
      brandDetail(val){
        if(this.isEdit){
            this.$http.get('category/getByBrand',{
              params:{
                brandId:val.id
              }
            }).then(resp =>{
              console.log(resp);
              let brand = val;
              brand.categories = resp.data.data;
              this.brand = brand;
            }).catch(error => console.log(error))
            // this.brand=val;
        }
      }
    },
    data () {
      //在js中 null == false , '' == false , undefined == false , 0 == false
      return {
        valid: true,
        nameRules:[
          (v) => !!v || '品牌名称不能为空',
          (v) => (v && v.length <= 10) || '品牌名称长度最长10'
        ],
        brand:{
            name:"",
            letter:"",
            categories:[],
          
        }
      }
    },
    methods:{
        cancel(){
            this.$emit("closeDialog");
        },
        submitForm(){
            if(!this.$refs.form.validate()){
                return;
            }
            let fromData = this.brand;
            let categoryIdArr = this.brand.categories.map(category =>category.id);
            fromData.categories = categoryIdArr.join();

            //$.ajax() 和 $.get() | $.post()方法的区别?
            this.$http({
              url:'/brand/save',
              data:fromData,
              method:this.isEdit ? 'put':'post'
              }).then(resp=>{
                if(resp.data.code != 200){
                    return;
                }
                   //关闭模态框
                    this.cancel();
            }).catch(error => console.log(error))
        }
    }   
  }
</script>
```

Cascader.vue(bug) line:162

```
 if(val && this.showAllLevels && !this.multiple){
            this.selected = [val.map(o => o[this.itemText]).join("/")]
          } else if (this.multiple && typeof val == 'object') {
            this.selected = val.map(o => {
              return {
                label: o[this.itemText],
                value: o[this.itemValue]
              }
            })
          } else {
            if(typeof val == 'object'){
              this.selected = [val[this.itemText]]
            }
          }
```

**上传图片**

在mingrui-shop-basics下新建mingrui-shop-basic-uploadserver

pom.xml

```
<dependencies>
    <!-- SpringBoot-整合Web组件 -->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>
    <dependency>
        <groupId>com.baidu</groupId>
        <artifactId>mingrui-shop-common-core</artifactId>
        <version>1.0-SNAPSHOT</version>
    </dependency>
</dpendencies>
```

application.yml

```
server:
  port: 8200
spring:
  application:
    name: upload-server
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
mingrui:
  upload:
    path:
      windows: E:\\images
      linux: /zhuyanlu/images
    img:
      host: http://image.mrshop.com
```

com.baidu新建启动类RunBasicUploadServer

```
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.cloud.netflix.eureka.EnableEurekaClient;

@SpringBootApplication
@EnableEurekaClient
public class RunBasicUploadServer {
    public static void main(String[] args) {
        SpringApplication.run(RunBasicUploadServer.class);
    }
}
```

新建包com.baidu.shop.upload.controller新建UploadController

```
package com.baidu.shop.upload.controller;

import com.baidu.shop.base.BaseApiService;
import com.baidu.shop.base.Result;
import com.baidu.shop.status.HTTPStatus;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import java.io.File;
import java.io.IOException;
import java.util.UUID;


@RestController
@RequestMapping(value = "upload")
public class UploadController extends BaseApiService {

    //linux系统的上传目录
    @Value(value = "${mingrui.upload.path.windows}")
    private String windowsPath;
    //window系统的上传目录
    @Value(value = "${mingrui.upload.path.linux}")
    private String linuxPath;
    //图片服务器的地址
    @Value(value = "${mingrui.upload.img.host}")
    private String imgHost;

    @PostMapping
    public Result<String> uploadImg(@RequestParam MultipartFile file) {
        if(file.isEmpty()) return this.setResultError("上传的文件为空");//判断上传的文件是否为空
        String filename = file.getOriginalFilename();//获取文件名
        String path = "";
        String os = System.getProperty("os.name").toLowerCase();
        if(os.indexOf("win") != -1){
            path = windowsPath;
        }else if(os.indexOf("lin") != -1){
            path = linuxPath;
        }
        filename = UUID.randomUUID() + filename;//防止文件名重复
//创建文件 路径+分隔符(linux和window的目录分隔符不一样)+文件名
        File dest = new File(path + File.separator + filename);
//判断文件夹是否存在,不存在的话就创建
        if(!dest.getParentFile().exists()) dest.getParentFile().mkdirs();
        try {
            file.transferTo(dest);//上传
        } catch (IllegalStateException e) {
// TODO Auto-generated catch block
            e.printStackTrace();
        } catch (IOException e) {
// TODO Auto-generated catch block
            e.printStackTrace();
        }
        return this.setResult(HTTPStatus.OK,"upload success!!!",imgHost + "/" +
                filename);//将文件名返回页面用于页面回显
    }
}
```

新建包:com.baidu.global新建GlobalCorsConfig

```
package com.baidu.global;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.UrlBasedCorsConfigurationSource;
import org.springframework.web.filter.CorsFilter;


@Configuration
public class GlobalCorsConfig {
    @Bean
    public CorsFilter corsFilter() {
        final UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        final CorsConfiguration config = new CorsConfiguration();
        config.setAllowCredentials(true); // 允许cookies跨域
        config.addAllowedOrigin("*");// 允许向该服务器提交请求的URI，*表示全部允许。。这里尽量限制来源域，比如http://xxxx:8080 ,以降低安全风险。。
        config.addAllowedHeader("*");// 允许访问的头信息,*表示全部
        config.setMaxAge(18000L);// 预检请求的缓存时间（秒），即在这个时间段里，对于相同的跨域请求不会再预检了
        config.addAllowedMethod("*");// 允许提交请求的方法，*表示全部允许，也可以单独设置GET、PUT等
        config.addAllowedMethod("HEAD");
        config.addAllowedMethod("GET");// 允许Get的请求方法
        config.addAllowedMethod("PUT");
        config.addAllowedMethod("POST");
        config.addAllowedMethod("DELETE");
        config.addAllowedMethod("PATCH");
        source.registerCorsConfiguration("/**", config);
        //3.返回新的CorsFilter.
        return new CorsFilter(source);
    }

}
```

使用postman测试上传

post请求localhost:8200(端口)/upload(UploadController方法名)

hosts文件中新增

```
127.0.0.1 image.mrshop.com
```

nginx-home/conf/nginx.conf新增

```
server { 
	listen 80; 
	server_name image.mrshop.com; 
	
	proxy_set_header X-Forwarded-Host $host; 
	proxy_set_header X-Forwarded-Server $host; 
	proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
	location ~ .*\.(gif|jpg|pdf|jpeg|png)$ { 
        #root D:/nginx-1.15.5/temp/images/;#指定图片存放路径(可以放在nginx文件夹路 径里也可以放其他p盘) root 				E:\images; 
	} 
		location / { 
			root html; 
			index index.html index.htm; 
		} 
	}
```

重启nginx

```
nginx.exe -s reload
```

浏览器输入http://image.mrshop.com/imageName.jpg测试

启动vue项目测试能否成功 ？

不能成功,还是请求了网关,

网关会吧api-xxx的请求转发到service-xxx的服务中,而service-xxx并没有 upload服务 

所以我想只要包含/upload请求的我都不进行路由

mingrui-shop-basic-zuul-server的application.yml

```
zuul:
  # 声明路由
  routes:
    # 路由名称
    api-xxx:
      # 声明将所有以/api-ribbon/的请求都转发到eureka-ribbon的服务中
      path: /api-xxx/**
      serviceId: xxx-server
  # 启用重试
  retryable: true
  # 包含此路径的不进行路由
  ignored-patterns: /upload/**
  # 忽略上传服务
  ignored-services:
    -upload-server
```

在nginx-home/conf/nginx.conf 添加api.mrshop.com的代理配置

```
# 上传路径的映射 
# 只要包含/api-xxx/upload 都会把请求映射到8200服务 
# rewrite "^/api-xxx/(.*)$" /$1 break;
# 将/api-xxx 替换成/ 
location /api-xxx/upload { 
	proxy_pass http://127.0.0.1:8200; 
	proxy_connect_timeout 600; 
	proxy_read_timeout 600; rewrite "^/api-xxx/(.*)$" /$1 break; 
}
```

重启nginx

```
nginx.exe -s reload
```

 **品牌管理(修改)**

​	回显

#### 后台

mingrui-shop-service-api-xxx

Service：CategoryService

```
@ApiOperation(value = "通过品牌id查询商品分类")
@GetMapping(value = "category/getByBrand")
Result<List<CategoryEntity>> getByBrand (Integer brandId);
```

mingrui-shop-service-xxx

com.baidu.shop.mapper：CategoryMapper

```
@Select(value = "select id,name from tb_category where id in (select category_id from tb_category_brand where brand_id=#{brandId})")
```

com.baidu.shop.service.impl：CategoryServiceImpl

```
//通过品牌查询商品id
@Override
public Result<List<CategoryEntity>> getByBrand(Integer brandId) {
    List<CategoryEntity> byBrandId = categoryMapper.getByBrandId(brandId);
    return this.setResultSuccess(byBrandI);
}
```

#### 前台

 MrBrand.vue

```
<template>
  <v-card>
    <v-card-title>
      <v-btn color="info" @click="dialog = true">新增</v-btn>
      <div class="text-xs-center">
        <v-dialog v-model="dialog" width="500">
          <v-card>
            <v-card-title class="headline grey lighten-2" primary-title>
            品牌 {{isEdit?'修改':'新增'}}
           </v-card-title>
            <mr-brand-form @closeDialog="closeDialog" :dialog="dialog" :isEdit="isEdit" :brandDetail="brandDetail"/>
          </v-card>
        </v-dialog>
      </div>
      <!-- 调按钮和输入框之间的间距 -->
      <v-spacer />
      <!--append-icon : 图标 label : input默认值-->
      <v-text-field
        append-icon="search"
        label="品牌名称"
        @keyup.enter="getTableData()"
        v-model="search"
      ></v-text-field>
    </v-card-title>
    <v-data-table
      :headers="headers"
      :items="desserts"
      :pagination.sync="pagination"
      :total-items="total"
      class="elevation-1"
    >
      <!-- 注意此处不能只能用官网的属性,应当参照Brand.vue的写法 -->
      <template slot="items" slot-scope="props">
        <td class="text-xs-center">{{ props.item.id }}</td>
        <td class="text-xs-center">{{ props.item.name }}</td>
        <!-- :src 给元素绑定src属性 属性的值为props.item.image -->
        <td class="text-xs-center">
          <img width="200" :src="props.item.image" />
          </td>
        <td class="text-xs-center">{{ props.item.letter }}</td>
        <td class="text-xs-center">
            <v-btn falt icon  @click="editDialog(props.item)" color="green">
                <v-icon>edit</v-icon>
            </v-btn>
            <v-btn falt icon @click="delDialog(props.item.id)" color="red">
                <v-icon>delete</v-icon>
            </v-btn>
        </td>
      </template>
    </v-data-table>
  </v-card>
</template>
<script>
import MrBrandForm from './MrBrandForm';
export default {
  name: "MrBrand",
  components:{
    MrBrandForm
  },
  data() {
    return {
      brandDetail:{},
      isEdit:false,
      dialog:false,
      pagination: {},
      total: 0,
      search: "",
      headers: [
        {
          text: "id",
          align: "center",
          value: "id",
        },
        {
          text: "品牌名称",
          align: "center",
          value: "name",
        },
        {
          text: "品牌logo",
          align: "center",
          value: "image",
        },
        {
          text: "首字母",
          align: "center",
          value: "letter",
        },
        {
          text: "操作",
          align: "center",
          sortable: false,
          value: "id",
        }
      ],
      desserts: [],
    };
  },
  mounted() {
    this.getTableData();
  },
  methods: {
    closeDialog(){
      this.dialog = false;
      this.getTableData()
    },
    addDialog(){
      this.isEdit = false;
      this.dialog = true;
    },
    editDialog(obj){
      this.brandDetail = obj;
      this.isEdit = true;
      this.dialog = true;
    },
    delDialog(id){
      this.$http.delete('brand/del?id=' + id).then(resp =>{
        if(resp.data.code == 200){
            this.getTableData()
            this.$message.success('删除成功')
        }else{
          this.$message.error(resp.data.msg)
        }
      }).catch(error => console.log(error))
    },
    getTableData() {
      this.$http
        .get("/brand/list", {
          params: {
            page: this.pagination.page,
            rows: this.pagination.rowsPerPage,
            sort: this.pagination.sortBy,
            order: this.pagination.descending,
            name: this.search,
          },
        })
        .then((resp) => {
          this.desserts = resp.data.data.list;
          this.total = resp.data.data.total;
        })
        .catch((error) => console.log(error));
    },
  },
  watch: {
    pagination() {
      this.getTableData();
    },
  },
};
</script>
```

MrBrandForm.vue

```
<template>
    <div>
            <v-form v-model="valid" ref="form">
                <v-text-field v-model="brand.name" label="品牌名称" :rules="nameRules" required></v-text-field>
                <v-cascader url="/category/list" required v-model="brand.categories" multiple label="商品分类"/>
                <!-- 文件上传 -->
                <v-layout row>
                    <v-flex xs3>
                      <span style="font-size: 16px; color: #444">品牌LOGO:</span>
                    </v-flex>
                    <v-flex>
                        <v-upload
                          v-model="brand.image"
                          url="/upload"
                          :multiple="false"
                          :pic-width="250"
                          :pic-height="100"
                        />
                    </v-flex>
                </v-layout> 
            </v-form>
         <v-card-actions>
          <v-spacer></v-spacer>
          <v-btn small @click="cancel()">取消</v-btn>
          <v-btn small color="red"  @click="submitForm">确认</v-btn>
        </v-card-actions>
    </div>
</template>
<script>
  export default {
    name:"MrBrandForm",
    props:{
      //父组件传递过来的模态框状态
      dialog: Boolean,
      brandDetail: Object,
      isEdit: Boolean
    },
    watch:{
      dialog(val){
        if(val) this.$refs.form.reset();
      },
      brandDetail(val){
        if(this.isEdit){
            this.$http.get('category/getByBrand',{
              params:{
                brandId:val.id
              }
            }).then(resp =>{
              console.log(resp);
              let brand = val;
              brand.categories = resp.data.data;
              this.brand = brand;
            }).catch(error => console.log(error))
            // this.brand=val;
        }
      }
    },
    data () {
      //在js中 null == false , '' == false , undefined == false , 0 == false
      return {
        valid: true,
        nameRules:[
          (v) => !!v || '品牌名称不能为空',
          (v) => (v && v.length <= 10) || '品牌名称长度最长10'
        ],
        brand:{
            name:"",
            letter:"",
            categories:[],
          
        }
      }
    },
    methods:{
        cancel(){
            this.$emit("closeDialog");
        },
        submitForm(){
            if(!this.$refs.form.validate()){
                return;
            }
            let fromData = this.brand;
            let categoryIdArr = this.brand.categories.map(category =>category.id);
            fromData.categories = categoryIdArr.join();

            //$.ajax() 和 $.get() | $.post()方法的区别?
            this.$http({
              url:'/brand/save',
              data:fromData,
              method:this.isEdit ? 'put':'post'
              }).then(resp=>{
                if(resp.data.code != 200){
                    return;
                }
                   //关闭模态框
                    this.cancel();
            }).catch(error => console.log(error))
        }
    }   
  }
</script>
```

### 修改

#### 后台

mingrui-shop-service-api-xxx

com.baidu.shop.service：BrandService

```
@PutMapping(value = "brand/save")
@ApiOperation(value = "修改品牌")
Result<JsonObject> eidt(@RequestBody BrandDto brandDto);
```

mingrui-shop-service-xxx

com.baidu.shop.service.impl：BrandServiceImpl

```
//修改品牌
@Transactional
@Override
public Result<JsonObject> eidt(BrandDto brandDto) {


    BrandEntity brandEntity = BaiduBeanUtil.copyProperties(brandDto, BrandEntity.class);

    brandEntity.setLetter(PinyinUtil.getUpperCase(String.valueOf(brandEntity.getName().toCharArray()[0]),false).toCharArray()[0]);
    brandMapper.updateByPrimaryKeySelective(brandEntity);
    //先通过brandId删除中间表的数据
    this.delteCategoryByBrandId(brandEntity.getId());
    //批量新增 / 新增
    this.insetrCategoryBrandList(brandDto.getCategories(),brandEntity.getId());
    return this.setResultSuccess();
}
```

```
//新增修改整合
private void insetrCategoryBrandList (String categories,Integer brandId){
    if (StringUtils.isEmpty(categories))throw new RuntimeException("分类信息不能为空");

    //判断分类集合字符串中是否包含,
    if(categories.contains(",")){
        categoryBrandMapper.insertList(
            //数组转list
            Arrays.asList(categories.split(","))
                    //获取stream流，流：对一次数据进行操作
                    .stream()
                    //遍历list中所有数据
                    .map(categoryById->new CategoryBrandEntity(Integer.valueOf(categoryById),brandId))
                    //最终转换成list
                    .collect(Collectors.toList())
        );
    }else{
        CategoryBrandEntity categoryBrandEntity = new CategoryBrandEntity();
        categoryBrandEntity.setCategoryId(Integer.valueOf(categories));
        categoryBrandEntity.setBrandId(brandId);

        categoryBrandMapper.insertSelective(categoryBrandEntity);
    }
}
```

**前台**

```
submitForm(){
            if(!this.$refs.form.validate()){
                return;
            }
            let fromData = this.brand;
            let categoryIdArr = this.brand.categories.map(category =>category.id);
            fromData.categories = categoryIdArr.join();

            //$.ajax() 和 $.get() | $.post()方法的区别?
            this.$http({
              url:'/brand/save',
              data:fromData,
              method:this.isEdit ? 'put':'post'
              }).then(resp=>{
                if(resp.data.code != 200){
                    return;
                }
                   //关闭模态框
                    this.cancel();
            }).catch(error => console.log(error))
        }
```

## 4.品牌删除

### 后台

mingrui-shop-service-api-xxx

com.baidu.shop.service：BrandService

```
@DeleteMapping(value = "brand/del")
@ApiOperation(value = "删除品牌")
Result<JsonObject> del( Integer id);
```

mingrui-shop-service-xxx：BrandServiceImpl

```
//删除品牌
@Override
public Result<JsonObject> del(Integer id) {
    //删除品牌信息
    brandMapper.deleteByPrimaryKey(id);
    this.delteCategoryByBrandId(id);
    return this.setResultSuccess();
}

private void  delteCategoryByBrandId (Integer brandId){
    Example example = new Example(CategoryBrandEntity.class);
    example.createCriteria().andEqualTo("brandId",brandId);
    categoryBrandMapper.deleteByExample(example);
}
```

**前台**

```
<v-btn falt icon @click="delDialog(props.item.id)" color="red">
                <v-icon>delete</v-icon>
            </v-btn>
```

```
delDialog(id){
      this.$http.delete('brand/del?id=' + id).then(resp =>{
        if(resp.data.code == 200){
            this.getTableData()
            this.$message.success('删除成功')
        }else{
          this.$message.error(resp.data.msg)
        }
      }).catch(error => console.log(error))
    },
```

